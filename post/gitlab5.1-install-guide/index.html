<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>김대리 Gitlab 5.1 설치하다 |  Insanehong's Incorrect Note</title>
    <meta name="description" content="Insanehong's Incorrect Note is designed to help people of web developer,designer, publisher and early beginnn er who are studying Front-end Technology for the development of web application.">
    <meta name="author" content="Insanehong">
    <meta name="keywords" content="javascript,html,css,frends,dart,leanstartup,fornt-end" />
    <meta name="generator" content="haroopress v0.9.2" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link href="/rss.xml" rel="alternate" title="Insanehong's Incorrect Note" type="application/rss+xml">

    <!-- Le styles -->
    <link rel="canonical" href="http://insanehong.kr">

    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/bootstrap-responsive.css" rel="stylesheet">
    <link href="/css/font-awesome.css" rel="stylesheet">
    <link href="/css/markdown.css" rel="stylesheet">
    <link href="/css/haroopress.css" rel="stylesheet">
    <link href="/css/theme.css" rel="stylesheet">
    <link href="/css/code/tomorrow-night.css" rel="stylesheet">
    
    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    <link rel="apple-touch-icon" sizes="72x72" href="/favicon-64.png">

    <!-- Le javascript -->
    <script src="/js/jquery.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/jquery.jsonp.js"></script>
    <script src="/js/mustache.js"></script>
    <script src="/js/apps/github.js"></script>
    <script src="/js/apps/twitter.js"></script>
</head>
<body data-spy="scroll" data-target=".subnav" data-offset="50">

        <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>

          <a class="pull-right" href="/rss.xml"><span class="icon-rss"></span></a>
          
            <a class="pull-right" href="http://twitter.com/insanehong" target="_blank"><span class="icon-twitter"></span></a>
          

          <div class="nav-collapse">
            <ul class="nav">
              <li>
                <a href="/">Home</a>
              </li>
              <li>
                <a href="/archives">Archives</a>
              </li>
              <li>
                <a href="/slides">Slides</a>
              </li>
                
                    <li>
                        <a href="/about/">About</a>
                    </li>
                
            </ul>
          </div>
        </div>
      </div>
    </div>

    
<link href="/css/code/tomorrow-night.css" rel="stylesheet">
<div class="container page-archive">
    <div class="row">
        <div class="span3">
            <div id="author" class="well">
                <div>
                    <h3>About Author</h3>
                    <ul class="thumbnails">
                        <li>
                            <a class="thumbnail">
                                <img src="http://www.gravatar.com/avatar/5e9df4b6c732d16a3b41d11d7288e195?r=pg&amp;s=128.jpg&amp;d=identicon" />
                            </a>
                        </li>
                    </ul>
                    <p>
                        <strong>Insanehong</strong><br/>
                        blog: <a href="http://insanehong.kr" target="_blank">http://insanehong.kr</a><br/>
                        twitter: <a href="http://twitter.com/insanehong" target="_blank">@insanehong</a><br/>
                        github: <a href="https://github.com/insanehong.github.com" target="_blank">insanehong.github.com</a>
                    </p>
                    <p>
                        <a href="https://twitter.com/insanehong" class="twitter-follow-button" data-show-count="true">Follow @insanehong</a>
                        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
                    </p>
                    <p>
                        <ul>
<li>NAVER Corporation, Front-End Engineer(2013~)</li>
<li>Like Javascript, Dart, HTML5, CSS3,Responsive Web, Haroopress, Frends, Lean Startup, Open Source</li>
<li><a href="http://hackrslab.github.io">Hackrslab</a> co-founder</li>
<li>About me <a href="http://about.me/insanehong">http://about.me/insanehong</a></li>
</ul>

                    </p>
                </div>
                <div>
                    <h3>About this Article</h3>
                    <p>
                        <h5>Date Released:</h5>
                        <span>Sunday, April 21 2013 11:15 AM</span>
                    </p>
                </div>
            </div>
                        <div class="well">
                <ul class="nav nav-list">
                    <li class="nav-header">Categories</li>
                    <li class=""><a href="/category"><i class="icon-home"></i> Home</a></li>
                    
                    <li><a href="/category/ajaxian"><i class="icon-book"></i> ajaxian</a></li>
                    
                    <li><a href="/category/essay"><i class="icon-book"></i> essay</a></li>
                    
                    <li><a href="/category/reference"><i class="icon-book"></i> reference</a></li>
                    
                    <li><a href="/category/yobi"><i class="icon-book"></i> yobi</a></li>
                    
                    <li><a href="/category/conference"><i class="icon-book"></i> conference</a></li>
                    
                    <li><a href="/category/git"><i class="icon-book"></i> git</a></li>
                    
                    <li><a href="/category/haroopress"><i class="icon-book"></i> haroopress</a></li>
                    
                    <li><a href="/category/javascript"><i class="icon-book"></i> javascript</a></li>
                    
                    <li><a href="/category/a11y"><i class="icon-book"></i> a11y</a></li>
                    
                    <li><a href="/category/dev-diary"><i class="icon-book"></i> dev-diary</a></li>
                    
                </ul>
            </div>

            
<div class="well">
    <ul class="nav nav-list">
        <li class="nav-header">Recent Articles</li>
    
        <li>
            <a href="/post/yobi-dev-diary-5th" target="_blank">yobi-dev-diary-5th
            <span class="label">Insanehong</span></a>
        </li>
    
        <li>
            <a href="/post/yobi-dev-diary-4th" target="_blank">yobi-dev-diary-4th
            <span class="label">Insanehong</span></a>
        </li>
    
        <li>
            <a href="/post/yobi-dev-diary-3rd" target="_blank">yobi-dev-diary-3rd
            <span class="label">Insanehong</span></a>
        </li>
    
        <li>
            <a href="/post/yobi-dev-diary-2nd" target="_blank">yobi-dev-diary-2nd
            <span class="label">Insanehong</span></a>
        </li>
    
        <li>
            <a href="/post/yobi-dev-diary-1st" target="_blank">yobi-dev-diary-1st
            <span class="label">Insanehong</span></a>
        </li>
    
    </ul>
</div>

        </div>
        <div class="span9">
            <div class="row">
                <div class="span9">
                    <div class="well bg">
                        
                        <div class="page-header">
                            <h1>김대리 Gitlab 5.1 설치하다</h1>
                        </div>

                        <div class="pull-right social-area">
                                                
                            <a href="https://twitter.com/share" class="twitter-share-button" data-lang="en" data-text="김대리 Gitlab 5.1 설치하다 -" data-url="http://insanehong.kr/post/gitlab5.1-install-guide" data-via="insanehong">Tweet</a>
                            <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
                    
                                                
                            <!-- Place this tag where you want the +1 button to render -->
                            <g:plusone href="/post/gitlab5.1-install-guide" size="medium"></g:plusone>

                            <!-- Place this render call where appropriate -->
                            <script type="text/javascript">
                              (function() {
                                var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
                                po.src = 'https://apis.google.com/js/plusone.js';
                                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
                              })();
                            </script>
                    

                            
        <div class="fb-like" data-send="false" data-layout="button_count" data-width="100" data-show-faces="false" data-font="arial" data-href="http://insanehong.kr/post/gitlab5.1-install-guide"></div>
        <div id="fb-root"></div>
        <script>(function(d, s, id) {
          var js, fjs = d.getElementsByTagName(s)[0];
          if (d.getElementById(id)) return;
          js = d.createElement(s); js.id = id;
          js.src = "//connect.facebook.net/ko_KR/all.js#xfbml=1&appId=246177242115486";
          fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));</script>

                        </div>

                        <div class="markdown-wrapper">
                            <p>2013년 3월 어느날 새벽 4시를 향해가고 있었고  몇시간의 사투 끝에 <a href="http://twitter.com/andrwj">@andrwj</a>와 페어 작업을 통해 <em class="label label-info"><strong>Gitlab 5.0</strong></em> 설치에 성공 하였다.</p><p>하지만 그당시 서버 설정 및 기타 설치에 관련한 <em class="label label-warning"><strong>꼼수</strong></em>들이 존재 했었고 권한에 있어서는 굉장히 난해한 상황이였던 이유로 처음부터 다시 깔끔한 설정으로 설치해 보고 싶어 졌다.</p><p>그래서 지금부터 <em class="label label-info"><strong>Gitlab 5.1</strong></em>를 재설치 하는 과정을 모두 이글에 담아보려고 한다.</p>
<h1 id="toc_137">Overview</h1>
<p>이 글은 <a href="https://github.com/gitlabhq/gitlabhq/blob/5-1-stable/doc/install/installation.md">Gitlab 5.1 stable 설치 가이드</a>를 기반으로 <em class="label label-info"><strong>Gitlab 5.1</strong></em>을 설치하는 과정을 담고 있다. 하지만 개인의 <em class="label label-important"><strong>선호도</strong></em>와 <em class="label label-important"><strong>스타일</strong></em>, <em class="label label-important"><strong>권한관리</strong></em> 관점등을 이유로 공식가이드와 다소 다른 부분이 많이 존재한다.</p><p>이 글은 설치 가이드가 아니다. 그런이유로 이 글에서 나오는 세팅이 마음에 맞지 않거나 불가능한 설정도 담겨 있다. 그러니 절대 이 글을 통해서 완벽한 설치에 도움을 받을것이라 기대하는 것은 무리일 것이다. </p>
<h2 id="toc_138">서버 환경</h2>

<ul>
<li>ubuntu 12.0.4</li>
<li>OS 만 설치 되어 있는 Clean Server</li>
<li>단, 호스팅 업체에서 OS 설치시 약간의 Package를 설치해 주었다.</li>
</ul>

<h2 id="toc_139">설치 Gitlab Package &amp; Dependencies</h2>

<ul>
<li>GitLab : v5.1 stable</li>
<li>Ruby : v1.9.3 with rvm</li>
<li>Python : v2.7</li>
<li>System Users : git</li>
<li>GitLab shell : v1.2.0</li>
<li>Mysql :  v5.5</li>
<li>Nginx : v1.1.19</li>
</ul>

<h1 id="toc_140">1. Packages &amp; Dependencies Install</h1>
<p>일단 가이드를 따라 <em class="label label-success"><strong>Dependency</strong></em> 되어있는 몇가지 <em class="label label-success"><strong>Package</strong></em> 들을 설치해야 했다. 페키지 설치는 너무나도 당연한 얘기지만 <em class="label label-success"><strong>apt-get</strong></em> 을 사용할 것이다.</p><p>현재는  <em class="label label-info"><strong>root</strong></em> 계정으로 로그인 되어있는 상태이다. </p>
<h2 id="toc_141">1.1 Packages Install</h2>
<p>모든 작업이 그렇게지만 페키지들을 설치 하기 앞서 페키지 메니저를 통한 업데이트와 메니저 업그레이드를 먼저 실시 해주었다. 물론 공식 문서에도 나와있다. </p><pre><code class="">// 패키지 설치에 사용할 apt-get <span class="operator"><span class="keyword">update</span> 및 upgrade
$ apt-<span class="keyword">get</span> <span class="keyword">update</span>
$ apt-<span class="keyword">get</span> upgrade
</span></code></pre><p>작업이 완료되고 공식 설치 가이드를 따라 필요한 페키지들의 설치를 시작하였다. 나중에 공식문서가 얼마나 부실한지 깨닿게 되었지만 지금 순간에는 중요한게 아니다.</p><pre><code class=""><span class="comment">$</span> <span class="comment">apt</span><span class="literal">-</span><span class="comment">get</span> <span class="comment">install</span> <span class="literal">-</span><span class="comment">y</span> <span class="comment">build</span><span class="literal">-</span><span class="comment">essential</span> <span class="comment">zlib1g</span><span class="literal">-</span><span class="comment">dev</span> <span class="comment">libyaml</span><span class="literal">-</span><span class="comment">dev</span> <span class="comment">libssl</span><span class="literal">-</span><span class="comment">dev</span> <span class="comment">libgdbm</span><span class="literal">-</span><span class="comment">dev</span> <span class="comment">libreadline</span><span class="literal">-</span><span class="comment">dev</span> <span class="comment">libncurses5</span><span class="literal">-</span><span class="comment">dev</span> <span class="comment">libffi</span><span class="literal">-</span><span class="comment">dev</span> <span class="comment">curl</span> <span class="comment">git</span><span class="literal">-</span><span class="comment">core</span> <span class="comment">openssh</span><span class="literal">-</span><span class="comment">server</span> <span class="comment">redis</span><span class="literal">-</span><span class="comment">server</span> <span class="comment">postfix</span> <span class="comment">checkinstall</span> <span class="comment">libxml2</span><span class="literal">-</span><span class="comment">dev</span> <span class="comment">libxslt</span><span class="literal">-</span><span class="comment">dev</span> <span class="comment">libcurl4</span><span class="literal">-</span><span class="comment">openssl</span><span class="literal">-</span><span class="comment">dev</span> <span class="comment">libicu</span><span class="literal">-</span><span class="comment">dev</span>
</code></pre><p>설치중 난데없이 <em class="label label-warning"><strong>postfix</strong></em> 호스트관련 설정을 하라는 녀석이 튀어 나왔다. postfix는 당장 사용할 생각도 없었고 필요할 때가 되면 <code>smtp.gmail.com</code> 을 사용할 계획이라 일단 <code>설정안함</code>을 선택해서 무시 했다. </p><p><img src="./@img/postfix.png" alt="ignore postfix setting"></p>
<h2 id="toc_142">1.2 Python 설치(2.5 &gt;= version)</h2>
<p>공식  설치 가이드에서 <em class="label label-important"><strong>python v2.5</strong></em> 이상을 설치하여야 하지만 아직 <em class="label label-important"><strong>v3.0</strong></em> 이상은 지원하지 않는다고 나와 있기에 <em class="label label-info"><strong>v2.7</strong></em> 버전을 설치 하기로 했다. </p>
<blockquote>
<p> Make sure you have the right version of Python installed. Make sure that Python is 2.5+ (3.x is not supported at the moment)</p></blockquote>
<pre><code class=""><span class="comment">// python 설치</span>
$ apt-get install <span class="keyword">python</span>

<span class="comment">// 설치 버전 확인</span>
$ <span class="keyword">python</span> --version
Python <span class="number">2.7</span><span class="number">.3</span>
</code></pre><p>설치 하려고 했던 버전이 잘 설치 되었음을 확인했다. 하지만 이부분은 설치 가이드에도 나와있듯이 정확한 버전을 설치 하는 것이 중요하니 공식문서상에 나와있는 이슈 해결부분을 마저 기록으로 남겨논다. </p><pre><code class="">// apt-<span class="built_in">get</span> install 시 python <span class="number">3</span> 가 설치 되는 경우 ver2<span class="number">.7</span>으로 재설치 한다.
$ apt-<span class="built_in">get</span> install python2<span class="number">.7</span>
<span class="comment">
// 설치버전을 반드시 다시 확인한다.
</span>$ python2 <span class="comment">--version</span>
<span class="comment">
// python2 install 후 버전 확인시 `command not found` error 가 발생할 경우 심볼릭 링크를 걸어 준다.
</span>$ <span class="built_in">ln</span> -s /usr/bin/python /usr/bin/python2
</code></pre>
<h1 id="toc_143">2. Mysql Install</h1>
<p><em class="label label-info"><strong>PostgreSQL</strong></em> 와 <em class="label label-info"><strong>Mysql</strong></em> 중 단 1초의 고민도 없이  <em class="label label-info"><strong>Mysql</strong></em>을 선택 했다. PostgreSQL를 사용하지 않은 이유는 너무나도 간단 했다. </p>
<blockquote>
<p>&quot;PostgreSQL를 사용해본적이 단 한번도 없었다.&quot; </p></blockquote>
<pre><code class=""><span class="comment">// Mysql 설치</span>
$ apt<span class="attribute">-get</span> install <span class="attribute">-y</span> mysql<span class="attribute">-server</span> mysql<span class="attribute">-client</span> libmysqlclient<span class="attribute">-dev</span>

<span class="comment">// user추가 및 database 생성을 위해 root 계정으로 로그인 한다.</span>
$ mysql <span class="attribute">-u</span> root <span class="attribute">-p</span>

<span class="comment">// database  생성</span>
mysql<span class="subst">&gt;</span> CREATE DATABASE <span class="keyword">IF</span> <span class="literal">NOT</span> EXISTS <span class="string">`gitlabhq_production`</span> DEFAULT CHARACTER <span class="built_in">SET</span> <span class="string">`utf8`</span> COLLATE <span class="string">`utf8_unicode_ci`</span>;

<span class="comment">// user 생성 및 권한 추가</span>
mysql<span class="subst">&gt;</span> GRANT <span class="literal">ALL</span> PRIVILEGES <span class="keyword">ON</span> gitlabhq_production<span class="built_in">.</span><span class="subst">*</span> <span class="keyword">to</span> <span class="string">'gitlab'</span>@<span class="string">'localhost'</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">'사용할 비밀번호'</span>;

mysql<span class="subst">&gt;</span> FLUSH PRIVILEGES;

mysql<span class="subst">&gt;</span> quit;
</code></pre><p>설치와 동시에 <em class="label label-success"><strong>database</strong></em>와 <em class="label label-success"><strong>user</strong></em> 추가까지 완료했으며 접속 테스트까지 수행해 본결과 성공적으로 마무리 되었다.</p>
<h1 id="toc_144">3. Gitlab User 추가</h1>
<p>설치 가이드에서는 계정추가 이전에 Ruby를 설치하라고 하지만 계정을 만드는 것을 먼저 진행했다. 계정추가를 먼저 진행한 이유는 다음과 같다.  </p>
<ul>
<li>rvm 을 통한 ruby 설치</li>
<li>git 계정 하위로 rvm 설치<br></li>
<li>독립적인 ruby 버전 관리를 통하여 Global 설치된 Ruby의 버전 변경에 영향을 받지 않기 위함.</li>
</ul>
<p>이부분에서는 <a href="http://twitter.com/andrwj">@andrwj</a> 의 조언이 큰 도움이 되었다. 곧 조공을 받쳐야 할듯 싶다.</p><p>어찌되었건 <em class="label label-info"><strong>git</strong></em> 계정 추가 작업을 설치가이드에 맞추어 진행 하였다. </p><pre><code class=""><span class="comment">//</span> <span class="comment">git</span> <span class="comment">계정은</span> <span class="comment">로그인</span> <span class="comment">비밀번호</span> <span class="comment">없이</span> <span class="comment">생성한다</span><span class="string">.</span>
<span class="comment">$</span> <span class="comment">adduser</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">disabled</span><span class="literal">-</span><span class="comment">login</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">gecos</span> <span class="comment">'GitLab'</span> <span class="comment">git</span>

<span class="comment">//</span> <span class="comment">git</span> <span class="comment">계정으로</span> <span class="comment">전환</span>
<span class="comment">$</span> <span class="comment">su</span> <span class="literal">-</span> <span class="comment">git</span>

<span class="comment">//</span> <span class="comment">이후</span> <span class="comment">작업을</span> <span class="comment">위해</span> <span class="comment">git</span> <span class="comment">디렉토리로</span> <span class="comment">변경</span>
<span class="comment">$</span> <span class="comment">cd</span> <span class="comment">/home/git</span>
</code></pre><p><em class="label label-info"><strong>git</strong></em> 계정을 추가하고 곧바로  <em class="label label-info"><strong>Ruby</strong></em> 설치 단계로 진행 하였다.</p>
<h1 id="toc_145">4. Ruby Install</h1>
<p>위에서 밝혔듯이 지금부터 나오는 내용은 공식문서와는 전혀 다르게 진행되었다. 개인적으로 공식문서에 나온 바이너리 설치가 못마땅(?)했기에 <em class="label label-info"><strong>RVM(Ruby Version Manager)</strong></em>을 사용해서 Ruby 를 설치 하기로 했고 설치 경로와 소유자는 당연히 <em class="label label-info"><strong>git</strong></em>이 되어야 했다.</p>
<h2 id="toc_146">4.1 RVM 설치</h2>
<pre><code class="">// rvm 을 설치
$ bash -s stable &lt; &lt;(curl -s https://raw.github.com/wayneeseguin/rvm/master/binscripts/rvm-installer)

// rvm 자동로드 .bash_profile 에 추가
$ echo <span class="string">'[[ -s "$HOME/.rvm/scripts/rvm" ]] &amp;&amp; . "$HOME/.rvm/scripts/rvm" # Load RVM function'</span> &gt;&gt; ~/.bash_profile

//  vi(vim)을 이용하여 직접 추가 하는 경우 
$ vi .bash_profile

// .bash_profile 에 추가될 내용
###### Ruby Version Manager
<span class="string">[[ -s "$HOME/.rvm/scripts/rvm" ]]</span> &amp;&amp; source <span class="string">"$HOME/.rvm/scripts/rvm"</span> # Load RVM into a shell session *as a <span class="function"><span class="keyword">function</span>*

// 재접속을 피하기 위해 바로 적용.
$ <span class="title">source</span> .<span class="title">bash_profile</span>

$ <span class="title">rvm</span> -<span class="title">v</span>
<span class="title">rvm</span> 1.19.6 <span class="params">(stable)</span></span> by Wayne E. Seguin &lt;wayneeseguin@gmail.com&gt;, Michal Papis &lt;mpapis@gmail.com&gt; [https://rvm.<span class="built_in">io</span>/]
</code></pre><p>RVM 이 제대로 설치 된것을 확인 했으니 Ruby 설치를 바로 진행 했다. </p>
<h2 id="toc_147">4.2 Ruby Install</h2>
<p>이제 RVM 을 사용해서 ruby를 설치하려고 했는데 문제가 발생 했다. ruby 를 설치하기 위해 필요한 몇가지 페키지들이 설치 되어 있지 않다고 오류가 나왔다. 
사실 RVM 설치를 할때 나왔던 메세지를 잘 읽어봤으면 생기지 않을 문제였지만 귀찮이즘과 시간단축을 위해 무시했던게 화근이기도 했다. </p><p><em class="label label-info"><strong>rvm requirements</strong></em> command 수행후 <em class="label label-important"><strong>Missing required packages:</strong></em> 부분에서 알려주는 페키지들을 설치(global install)해 주어야 했다.</p><p><img src="./@img/ruby-dependency.png" alt="ruby-dependency"> </p><p>패키지 설치를 위해서 잠시 <em class="label label-info"><strong>root</strong></em> 계정으로 변경 하였다. </p><pre><code class=""><span class="comment">// 누락된 페키지들을 설치한다. </span>
$ apt<span class="attribute">-get</span> install libsqlite3<span class="attribute">-dev</span> sqlite3 autoconf automake libtool bison

<span class="comment">// 설치가 완료되면 git 계정으로 전환한다.</span>
$ su <span class="subst">-</span> git

$ cd <span class="subst">/</span>home<span class="subst">/</span>git

<span class="comment">// Dependency 확인</span>
$ rvm requirements
Installing requirements for ubuntu, might <span class="keyword">require</span> sudo password<span class="built_in">.</span>
Skipping <span class="string">`apt-get update`</span> make sure your system is up <span class="keyword">to</span> <span class="built_in">date</span><span class="built_in">.</span>
RVM autolibs is now configured <span class="keyword">with</span> mode <span class="string">'2'</span> <span class="subst">=&gt;</span> <span class="string">'check and stop if missing'</span>,
please run <span class="string">`rvm autolibs enable`</span> <span class="keyword">to</span> <span class="keyword">let</span> RVM <span class="keyword">do</span> its job <span class="literal">or</span> run <span class="literal">and</span> read <span class="string">`rvm autolibs [help]`</span>
<span class="literal">or</span> visit https:<span class="comment">//rvm.io/rvm/autolibs for more information.</span>
</code></pre><p>패키지 설치가 완료 되어 더이상 <em class="label label-important"><strong>Missing required packages:</strong></em> 부분이 출력되지 않았다. 드디어 Ruby 를 설치할 수 있는 환경이 만들어졌다. </p><p>공식 문서상에 나와 있고 설치관련 각종 이슈등에서도 v1.9.3 버전을 설치하라고 나와 있어 그대로 따르기로 했다. </p><pre><code class=""><span class="comment">//</span> <span class="comment">rvm</span> <span class="comment">을</span> <span class="comment">사용하여</span> <span class="comment">ruby</span> <span class="comment">v1</span><span class="string">.</span><span class="comment">9</span><span class="string">.</span><span class="comment">3</span> <span class="comment">을</span> <span class="comment">설치한다</span><span class="string">.</span>
<span class="comment">$</span> <span class="comment">rvm</span> <span class="comment">install</span> <span class="comment">1</span><span class="string">.</span><span class="comment">9</span><span class="string">.</span><span class="comment">3</span>

<span class="comment">//</span> <span class="comment">설치후</span> <span class="comment">시스템에서</span> <span class="comment">사용할</span> <span class="comment">ruby</span> <span class="comment">버전으로</span> <span class="comment">등록해</span> <span class="comment">준다</span><span class="string">.</span>
<span class="comment">$</span> <span class="comment">rvm</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">default</span> <span class="comment">ruby</span><span class="literal">-</span><span class="comment">1</span><span class="string">.</span><span class="comment">9</span><span class="string">.</span><span class="comment">3</span>

<span class="comment">//</span> <span class="comment">지정한</span> <span class="comment">버전이</span> <span class="comment">설정</span> <span class="comment">되어있는지</span> <span class="comment">확인한다</span><span class="string">.</span>
<span class="comment">$</span> <span class="comment">ruby</span> <span class="literal">-</span><span class="comment">v</span>
<span class="comment">ruby</span> <span class="comment">1</span><span class="string">.</span><span class="comment">9</span><span class="string">.</span><span class="comment">3p392</span> <span class="comment">(2013</span><span class="literal">-</span><span class="comment">02</span><span class="literal">-</span><span class="comment">22</span> <span class="comment">revision</span> <span class="comment">39386)</span> <span class="title">[</span><span class="comment">x86_64</span><span class="literal">-</span><span class="comment">linux</span><span class="title">]</span>

<span class="comment">//</span> <span class="comment">bundler</span> <span class="comment">설치</span><span class="string">.</span>
<span class="comment">$</span> <span class="comment">gem</span> <span class="comment">install</span> <span class="comment">bundler</span> 
</code></pre><p>이렇게 해서 ruby 설치는 완료 되었다. </p>
<h1 id="toc_148">5. Gitlab-Shell Install</h1>
<p>이어서 Gitlab 5.x 에서 새로 적용된 <em class="label label-info"><strong>Gitlab-Shell</strong></em>을 설치했다. 이녀석으로 인하여 설치가 간편해졌다고 하지만 지금까지 작업만으로도 숨가뿌게 달리고 지루하 일이였던 것 만큼 간편해졌다는게 전혀 와닿지 않는다. 어째든 설치는 계속 진행 되었다.</p><p>사실 이후에 v1.3.0 으로 재설치 하였다. 왜 그렇게 했는지는 기록해 두었다. 이글을 따라서 설치하는 사람이 있다면 애당초  v1.3.0 branch를 사용할 것을 추천한다.</p><pre><code class=""><span class="comment">// gitlab-shell 을 Clone 받는다. </span>
$ git clone https:<span class="comment">//github.com/gitlabhq/gitlab-shell.git</span>

$ <span class="built_in">cd</span> gitlab-shell

<span class="comment">// v1.2.0  branch 로 변경한다.</span>
$ git checkout -b <span class="transposed_variable">v1.</span><span class="number">2.0</span>

<span class="comment">// 환경세팅파일을 복사한다.</span>
$ cp <span class="transposed_variable">config.</span><span class="transposed_variable">yml.</span>example <span class="transposed_variable">config.</span>yml

<span class="comment">// gitlab에 사용될 URL 정보를 수정해 한다.</span>
$ vi <span class="transposed_variable">config.</span>yml
</code></pre><p><em class="label label-info"><strong>config.yml</strong></em> 파일을 열어보면 <code>gitlab_url: &quot;http://localhost/&quot;</code> 로 되어 있는 부분이 있는데 이놈을 `gitlab.ninjacamp.org&#39;로 수정을 해주었다.</p><p><img src="./@img/config-yml.png" alt="config-yml"></p><p>수정이 완료 후 설치 스크립트를 실행해 주었다. </p><pre><code class=""><span class="comment">// Gitlab-shell 을 설치한다.</span>
$ .<span class="regexp">/bin/i</span>nstall

</code></pre><p>설치가 완료되면 <em class="label label-info"><strong>/home/git/.ssh/</strong></em> 디렉토리에  <em class="label label-important"><strong>authorized_keys</strong></em> 라는 파일이 생성되는데 gitlab이 repository로 접근하는 데 사용되는 인증키이다. 4.0 버전에서는 별도로 ssh key 생성을 해주어야 했는데 자동으로 생성해주니 편리하긴 했다. </p>
<h1 id="toc_149">6. GitLab Install</h1>
<p>지금까지 열심히 달려왔지만 이제서야 <em class="label label-info"><strong>Gitlab</strong></em> 을 설치하게 되었다. 만약 이 글을 따라하고 있는 사람이 있다면 앞으로 남은길이 산더미 같으니 포기하려면 지금 내려 놓는 것이 정신 건강에 좋을 것이다. </p>
<h2 id="toc_150">6.1 Clone the Gitlab 5.1</h2>
<p><em class="label label-info"><strong>Gitlab-shell</strong></em> 설치를 위해 디렉토리의 변경이 있었기에 작업디렉토리를 변경해주는 것을 잊지 말고 수행해줘야 했다. 사실 신경안쓰고 넘어갈뻔 하기도 했다.</p><pre><code class=""><span class="comment">// 작업디렉토리 변경</span>
$ cd <span class="subst">/</span>home<span class="subst">/</span>git

<span class="comment">// clone the gitlab source </span>
$ git clone https:<span class="comment">//github.com/gitlabhq/gitlabhq.git gitlab</span>

<span class="comment">// clone 받은 gitlab 디렉토리로 이동한다. </span>
$ cd gitlab

$ git checkout <span class="attribute">-b</span> <span class="number">5</span><span class="subst">-</span><span class="number">1</span><span class="attribute">-stable</span> 
</code></pre><p>gitlab 공식 가이드에 따르면  <em class="label label-important"><strong>master branch</strong></em> 를 사용해도 되지만  <em class="label label-important"><strong>stable branch</strong></em> 사용을 권장하고 있었다. 정신건강을 위해 가이드를 따르는 것이 좋을거 같았다.</p>
<blockquote>
<p>Note: You can change 5-1-stable to master if you want the bleeding edge version, but do so with caution!</p></blockquote>

<h2 id="toc_151">6.2 Gitlab Configure</h2>
<p>지금부터의 작업은 지겨운 설정과의 싸움이며 <em class="label label-info"><strong>gem</strong></em>과의 전쟁의 시초가 되었다. 아마 앞으로 나올 설정중 이부분이 가장 간단하게 완료된 부분이 아니였나 생각한다. 실제로도 할게 거이 없기도 하다. </p><pre><code class=""><span class="comment">// gitlab 설정 파일을 복사한다.</span>
$ cp  config/<span class="transposed_variable">gitlab.</span><span class="transposed_variable">yml.</span>example config/<span class="transposed_variable">gitlab.</span>yml

<span class="comment">// 복사된 설정 파일을 열어 `localhost` 부분을 `gitlab-shell` 설정에 추가한 URL로 변경해 준다.</span>
$ vi config/<span class="transposed_variable">gitlab.</span>yml
</code></pre><p><em class="label label-info"><strong>gitlab.yml</strong></em> 파일을 열어보면 <code>production</code> 부분에 3개의 <em class="label label-important"><strong>localhost</strong></em>가 존재한다. 각각 <em class="label label-success"><strong>host</strong></em>, <em class="label label-success"><strong>email_from</strong></em>, <em class="label label-success"><strong>support_email</strong></em> 인데 이부분을 수정해 주었다.</p><p><img src="./@img/gitlab-config-yml.png" alt="gitlab-config-yml"> </p><p>수정이 완료되면 디렉토리에 대한 약간의 작업을 진행 했다. 공식문서에 나온 가이드를 옮겨왔지만 개인적으로 모든 작업을 <em class="label label-info"><strong>git</strong></em> 계정으로 해놨기에 불필요한 부분도 있었다. </p><pre><code class=""><span class="comment">// /log, /tmp 디렉토리의 소유자와 권한을 수정해 준다.</span>
<span class="comment">// git 계정으로 작업하였기에 소유자는 굳이 손대지 않아도 되었다.</span>
$ chown <span class="attribute">-R</span> git tmp<span class="subst">/</span>
$ chmod <span class="attribute">-R</span> u<span class="subst">+</span>rwX  tmp<span class="subst">/</span>
$ chown <span class="attribute">-R</span> git <span class="keyword">log</span><span class="subst">/</span>
$ chmod <span class="attribute">-R</span> u<span class="subst">+</span>rwX <span class="keyword">log</span><span class="subst">/</span>

<span class="comment">// gitlab-satellites 디렉토리를 생성해 준다.</span>
$ mkdir <span class="subst">/</span>home<span class="subst">/</span>git<span class="subst">/</span>gitlab<span class="attribute">-satellites</span>

<span class="comment">// /home/git/gitlab/tmp 디렉토리에 `pids`를 생성해 준다.</span>
$ mkdir tmp<span class="subst">/</span>pids<span class="subst">/</span> 

$ chmod <span class="attribute">-R</span> u<span class="subst">+</span>rwX  tmp<span class="subst">/</span>pids 
</code></pre>
<h2 id="toc_152">6.3 puma.rb 설정</h2>
<p><a href="http://twitter.com/andrwj">@andrwj</a>의 말에 따르면 이녀석은 unicorn 의 대체자로 gitlab 시작 스크립트가 이전버전(5.0 &gt;=) 에서는 <em class="label label-important"><strong>unicorn</strong></em> 을 호출하고 v5.1 부터는 <em class="label label-important"><strong>puma</strong></em>를 호출하게 변경 되었다고 한다.</p><pre><code class=""><span class="comment">// puma 설정파일을 복사 한다.</span>
$ cp config/puma.rb.example config/puma.rb

<span class="comment">// tcp 사용을 위한 수정</span>
$ vi config/puma.rb

<span class="comment">// replace config</span>
<span class="comment">// from</span>
<span class="comment"># bind "tcp://0.0.0.0:9292"</span>
bind <span class="string">"unix://#{application_path}/tmp/sockets/gitlab.socket

//to
bind "</span>tcp:<span class="comment">//gitlab.ninjacamp.org:9292 </span>
<span class="comment"># bind "unix://#{application_path}/tmp/sockets/gitlab.socket</span>
</code></pre>
<h2 id="toc_153">6.4 database 설정</h2>
<p>위에서 메모해둔 mysql 정보를 써먹을때가 왔다. 사실 절대 잊어버릴수 없는 비밀번호임을 다시 생각해본다. </p><pre><code class=""><span class="comment">// mysql 설정 파일을 복사 한다.</span>
$ cp config/<span class="transposed_variable">database.</span><span class="transposed_variable">yml.</span>mysql config/<span class="transposed_variable">database.</span>yml

<span class="comment">// production 설정을 생성한 database 맞게 수정한다.</span>
$ vi config/<span class="transposed_variable">database.</span>yml
</code></pre><p><em class="label label-info"><strong>database.yml</strong></em> 파일을 열어보면 <em class="label label-important"><strong>production</strong></em>, <em class="label label-important"><strong>development</strong></em>, <em class="label label-important"><strong>test</strong></em> 의 3가지 섹션이 존재 한다. 하지만 이번 설치에서는 <em class="label label-important"><strong>production</strong></em> 부분만을 수정했다. </p><p><em class="label label-info"><strong>username</strong></em> 과 <em class="label label-info"><strong>password</strong></em> 만 위에서 생성한 정보로 수정 했다. </p><p><img src="./@img/database.png" alt="worker"> </p>
<h2 id="toc_154">6.5 Install Gems</h2>
<p>이제부터가 진정한 싸움의 시작을 알리는 서막이였다. 처음부터 오류가 터져 나와 주었다. <em class="label label-important"><strong>charlock_holmes</strong></em> 설치가 되지 않았던 것이다. </p><pre><code class=""><span class="comment">$</span> <span class="comment">gem</span> <span class="comment">install</span> <span class="comment">charlock_holmes</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">version</span> <span class="comment">'0</span><span class="string">.</span><span class="comment">6</span><span class="string">.</span><span class="comment">9'</span>

<span class="comment">Building</span> <span class="comment">native</span> <span class="comment">extensions</span><span class="string">.</span>  <span class="comment">This</span> <span class="comment">could</span> <span class="comment">take</span> <span class="comment">a</span> <span class="comment">while</span><span class="string">.</span><span class="string">.</span><span class="string">.</span>
<span class="comment">ERROR:</span>  <span class="comment">Error</span> <span class="comment">installing</span> <span class="comment">charlock_holmes:</span>
    <span class="comment">ERROR:</span> <span class="comment">Failed</span> <span class="comment">to</span> <span class="comment">build</span> <span class="comment">gem</span> <span class="comment">native</span> <span class="comment">extension</span><span class="string">.</span>

        <span class="comment">/home/git/</span><span class="string">.</span><span class="comment">rvm/rubies/ruby</span><span class="literal">-</span><span class="comment">1</span><span class="string">.</span><span class="comment">9</span><span class="string">.</span><span class="comment">3</span><span class="literal">-</span><span class="comment">p392/bin/ruby</span> <span class="comment">extconf</span><span class="string">.</span><span class="comment">rb</span>
<span class="comment">checking</span> <span class="comment">for</span> <span class="comment">main()</span> <span class="comment">in</span> <span class="literal">-</span><span class="comment">licui18n</span><span class="string">.</span><span class="string">.</span><span class="string">.</span> <span class="comment">***</span> <span class="comment">extconf</span><span class="string">.</span><span class="comment">rb</span> <span class="comment">failed</span> <span class="comment">***</span>
<span class="comment">Could</span> <span class="comment">not</span> <span class="comment">create</span> <span class="comment">Makefile</span> <span class="comment">due</span> <span class="comment">to</span> <span class="comment">some</span> <span class="comment">reason</span><span class="string">,</span> <span class="comment">probably</span> <span class="comment">lack</span> <span class="comment">of</span>
<span class="comment">necessary</span> <span class="comment">libraries</span> <span class="comment">and/or</span> <span class="comment">headers</span><span class="string">.</span>  <span class="comment">Check</span> <span class="comment">the</span> <span class="comment">mkmf</span><span class="string">.</span><span class="comment">log</span> <span class="comment">file</span> <span class="comment">for</span> <span class="comment">more</span>
<span class="comment">details</span><span class="string">.</span>  <span class="comment">You</span> <span class="comment">may</span> <span class="comment">need</span> <span class="comment">configuration</span> <span class="comment">options</span><span class="string">.</span>

<span class="comment">Provided</span> <span class="comment">configuration</span> <span class="comment">options:</span>
    <span class="literal">-</span><span class="literal">-</span><span class="comment">with</span><span class="literal">-</span><span class="comment">opt</span><span class="literal">-</span><span class="comment">dir</span>
    <span class="literal">-</span><span class="literal">-</span><span class="comment">without</span><span class="literal">-</span><span class="comment">opt</span><span class="literal">-</span><span class="comment">dir</span>
    <span class="literal">-</span><span class="literal">-</span><span class="comment">with</span><span class="literal">-</span><span class="comment">opt</span><span class="literal">-</span><span class="comment">include</span>
    <span class="literal">-</span><span class="literal">-</span><span class="comment">without</span><span class="literal">-</span><span class="comment">opt</span><span class="literal">-</span><span class="comment">include=${opt</span><span class="literal">-</span><span class="comment">dir}/include</span>
    <span class="literal">-</span><span class="literal">-</span><span class="comment">with</span><span class="literal">-</span><span class="comment">opt</span><span class="literal">-</span><span class="comment">lib</span>
    <span class="literal">-</span><span class="literal">-</span><span class="comment">without</span><span class="literal">-</span><span class="comment">opt</span><span class="literal">-</span><span class="comment">lib=${opt</span><span class="literal">-</span><span class="comment">dir}/lib</span>
    <span class="literal">-</span><span class="literal">-</span><span class="comment">with</span><span class="literal">-</span><span class="comment">make</span><span class="literal">-</span><span class="comment">prog</span>
    <span class="literal">-</span><span class="literal">-</span><span class="comment">without</span><span class="literal">-</span><span class="comment">make</span><span class="literal">-</span><span class="comment">prog</span>
    <span class="literal">-</span><span class="literal">-</span><span class="comment">srcdir=</span><span class="string">.</span>
    <span class="literal">-</span><span class="literal">-</span><span class="comment">curdir</span>
    <span class="literal">-</span><span class="literal">-</span><span class="comment">ruby=/home/git/</span><span class="string">.</span><span class="comment">rvm/rubies/ruby</span><span class="literal">-</span><span class="comment">1</span><span class="string">.</span><span class="comment">9</span><span class="string">.</span><span class="comment">3</span><span class="literal">-</span><span class="comment">p392/bin/ruby</span>
    <span class="literal">-</span><span class="literal">-</span><span class="comment">with</span><span class="literal">-</span><span class="comment">icu</span><span class="literal">-</span><span class="comment">dir</span>
    <span class="literal">-</span><span class="literal">-</span><span class="comment">without</span><span class="literal">-</span><span class="comment">icu</span><span class="literal">-</span><span class="comment">dir</span>
    <span class="literal">-</span><span class="literal">-</span><span class="comment">with</span><span class="literal">-</span><span class="comment">icu</span><span class="literal">-</span><span class="comment">include</span>
    <span class="literal">-</span><span class="literal">-</span><span class="comment">without</span><span class="literal">-</span><span class="comment">icu</span><span class="literal">-</span><span class="comment">include=${icu</span><span class="literal">-</span><span class="comment">dir}/include</span>
    <span class="literal">-</span><span class="literal">-</span><span class="comment">with</span><span class="literal">-</span><span class="comment">icu</span><span class="literal">-</span><span class="comment">lib</span>
    <span class="literal">-</span><span class="literal">-</span><span class="comment">without</span><span class="literal">-</span><span class="comment">icu</span><span class="literal">-</span><span class="comment">lib=${icu</span><span class="literal">-</span><span class="comment">dir}/lib</span>
    <span class="literal">-</span><span class="literal">-</span><span class="comment">with</span><span class="literal">-</span><span class="comment">icui18nlib</span>
    <span class="literal">-</span><span class="literal">-</span><span class="comment">without</span><span class="literal">-</span><span class="comment">icui18nlib</span>
<span class="comment">/home/git/</span><span class="string">.</span><span class="comment">rvm/rubies/ruby</span><span class="literal">-</span><span class="comment">1</span><span class="string">.</span><span class="comment">9</span><span class="string">.</span><span class="comment">3</span><span class="literal">-</span><span class="comment">p392/lib/ruby/1</span><span class="string">.</span><span class="comment">9</span><span class="string">.</span><span class="comment">1/mkmf</span><span class="string">.</span><span class="comment">rb:381:in</span> <span class="comment">`try_do':</span> <span class="comment">The</span> <span class="comment">compiler</span> <span class="comment">failed</span> <span class="comment">to</span> <span class="comment">generate</span> <span class="comment">an</span> <span class="comment">executable</span> <span class="comment">file</span><span class="string">.</span> <span class="comment">(RuntimeError)</span>
<span class="comment">You</span> <span class="comment">have</span> <span class="comment">to</span> <span class="comment">install</span> <span class="comment">development</span> <span class="comment">tools</span> <span class="comment">first</span><span class="string">.</span>
    <span class="comment">from</span> <span class="comment">/home/git/</span><span class="string">.</span><span class="comment">rvm/rubies/ruby</span><span class="literal">-</span><span class="comment">1</span><span class="string">.</span><span class="comment">9</span><span class="string">.</span><span class="comment">3</span><span class="literal">-</span><span class="comment">p392/lib/ruby/1</span><span class="string">.</span><span class="comment">9</span><span class="string">.</span><span class="comment">1/mkmf</span><span class="string">.</span><span class="comment">rb:461:in</span> <span class="comment">`try_link0'</span>
    <span class="comment">from</span> <span class="comment">/home/git/</span><span class="string">.</span><span class="comment">rvm/rubies/ruby</span><span class="literal">-</span><span class="comment">1</span><span class="string">.</span><span class="comment">9</span><span class="string">.</span><span class="comment">3</span><span class="literal">-</span><span class="comment">p392/lib/ruby/1</span><span class="string">.</span><span class="comment">9</span><span class="string">.</span><span class="comment">1/mkmf</span><span class="string">.</span><span class="comment">rb:476:in</span> <span class="comment">`try_link'</span>
    <span class="comment">from</span> <span class="comment">/home/git/</span><span class="string">.</span><span class="comment">rvm/rubies/ruby</span><span class="literal">-</span><span class="comment">1</span><span class="string">.</span><span class="comment">9</span><span class="string">.</span><span class="comment">3</span><span class="literal">-</span><span class="comment">p392/lib/ruby/1</span><span class="string">.</span><span class="comment">9</span><span class="string">.</span><span class="comment">1/mkmf</span><span class="string">.</span><span class="comment">rb:619:in</span> <span class="comment">`try_func'</span>
    <span class="comment">from</span> <span class="comment">/home/git/</span><span class="string">.</span><span class="comment">rvm/rubies/ruby</span><span class="literal">-</span><span class="comment">1</span><span class="string">.</span><span class="comment">9</span><span class="string">.</span><span class="comment">3</span><span class="literal">-</span><span class="comment">p392/lib/ruby/1</span><span class="string">.</span><span class="comment">9</span><span class="string">.</span><span class="comment">1/mkmf</span><span class="string">.</span><span class="comment">rb:845:in</span> <span class="comment">`block</span> <span class="comment">in</span> <span class="comment">have_library'</span>
    <span class="comment">from</span> <span class="comment">/home/git/</span><span class="string">.</span><span class="comment">rvm/rubies/ruby</span><span class="literal">-</span><span class="comment">1</span><span class="string">.</span><span class="comment">9</span><span class="string">.</span><span class="comment">3</span><span class="literal">-</span><span class="comment">p392/lib/ruby/1</span><span class="string">.</span><span class="comment">9</span><span class="string">.</span><span class="comment">1/mkmf</span><span class="string">.</span><span class="comment">rb:790:in</span> <span class="comment">`block</span> <span class="comment">in</span> <span class="comment">checking_for'</span>
    <span class="comment">from</span> <span class="comment">/home/git/</span><span class="string">.</span><span class="comment">rvm/rubies/ruby</span><span class="literal">-</span><span class="comment">1</span><span class="string">.</span><span class="comment">9</span><span class="string">.</span><span class="comment">3</span><span class="literal">-</span><span class="comment">p392/lib/ruby/1</span><span class="string">.</span><span class="comment">9</span><span class="string">.</span><span class="comment">1/mkmf</span><span class="string">.</span><span class="comment">rb:284:in</span> <span class="comment">`block</span> <span class="comment">(2</span> <span class="comment">levels)</span> <span class="comment">in</span> <span class="comment">postpone'</span>
    <span class="comment">from</span> <span class="comment">/home/git/</span><span class="string">.</span><span class="comment">rvm/rubies/ruby</span><span class="literal">-</span><span class="comment">1</span><span class="string">.</span><span class="comment">9</span><span class="string">.</span><span class="comment">3</span><span class="literal">-</span><span class="comment">p392/lib/ruby/1</span><span class="string">.</span><span class="comment">9</span><span class="string">.</span><span class="comment">1/mkmf</span><span class="string">.</span><span class="comment">rb:254:in</span> <span class="comment">`open'</span>
    <span class="comment">from</span> <span class="comment">/home/git/</span><span class="string">.</span><span class="comment">rvm/rubies/ruby</span><span class="literal">-</span><span class="comment">1</span><span class="string">.</span><span class="comment">9</span><span class="string">.</span><span class="comment">3</span><span class="literal">-</span><span class="comment">p392/lib/ruby/1</span><span class="string">.</span><span class="comment">9</span><span class="string">.</span><span class="comment">1/mkmf</span><span class="string">.</span><span class="comment">rb:284:in</span> <span class="comment">`block</span> <span class="comment">in</span> <span class="comment">postpone'</span>
    <span class="comment">from</span> <span class="comment">/home/git/</span><span class="string">.</span><span class="comment">rvm/rubies/ruby</span><span class="literal">-</span><span class="comment">1</span><span class="string">.</span><span class="comment">9</span><span class="string">.</span><span class="comment">3</span><span class="literal">-</span><span class="comment">p392/lib/ruby/1</span><span class="string">.</span><span class="comment">9</span><span class="string">.</span><span class="comment">1/mkmf</span><span class="string">.</span><span class="comment">rb:254:in</span> <span class="comment">`open'</span>
    <span class="comment">from</span> <span class="comment">/home/git/</span><span class="string">.</span><span class="comment">rvm/rubies/ruby</span><span class="literal">-</span><span class="comment">1</span><span class="string">.</span><span class="comment">9</span><span class="string">.</span><span class="comment">3</span><span class="literal">-</span><span class="comment">p392/lib/ruby/1</span><span class="string">.</span><span class="comment">9</span><span class="string">.</span><span class="comment">1/mkmf</span><span class="string">.</span><span class="comment">rb:280:in</span> <span class="comment">`postpone'</span>
    <span class="comment">from</span> <span class="comment">/home/git/</span><span class="string">.</span><span class="comment">rvm/rubies/ruby</span><span class="literal">-</span><span class="comment">1</span><span class="string">.</span><span class="comment">9</span><span class="string">.</span><span class="comment">3</span><span class="literal">-</span><span class="comment">p392/lib/ruby/1</span><span class="string">.</span><span class="comment">9</span><span class="string">.</span><span class="comment">1/mkmf</span><span class="string">.</span><span class="comment">rb:789:in</span> <span class="comment">`checking_for'</span>
    <span class="comment">from</span> <span class="comment">/home/git/</span><span class="string">.</span><span class="comment">rvm/rubies/ruby</span><span class="literal">-</span><span class="comment">1</span><span class="string">.</span><span class="comment">9</span><span class="string">.</span><span class="comment">3</span><span class="literal">-</span><span class="comment">p392/lib/ruby/1</span><span class="string">.</span><span class="comment">9</span><span class="string">.</span><span class="comment">1/mkmf</span><span class="string">.</span><span class="comment">rb:840:in</span> <span class="comment">`have_library'</span>
    <span class="comment">from</span> <span class="comment">extconf</span><span class="string">.</span><span class="comment">rb:27:in</span> <span class="comment">`</span>&lt;<span class="comment">main</span>&gt;<span class="comment">'</span>


<span class="comment">Gem</span> <span class="comment">files</span> <span class="comment">will</span> <span class="comment">remain</span> <span class="comment">installed</span> <span class="comment">in</span> <span class="comment">/home/git/</span><span class="string">.</span><span class="comment">rvm/gems/ruby</span><span class="literal">-</span><span class="comment">1</span><span class="string">.</span><span class="comment">9</span><span class="string">.</span><span class="comment">3</span><span class="literal">-</span><span class="comment">p392/gems/charlock_holmes</span><span class="literal">-</span><span class="comment">0</span><span class="string">.</span><span class="comment">6</span><span class="string">.</span><span class="comment">9</span> <span class="comment">for</span> <span class="comment">inspection</span><span class="string">.</span>
<span class="comment">Results</span> <span class="comment">logged</span> <span class="comment">to</span> <span class="comment">/home/git/</span><span class="string">.</span><span class="comment">rvm/gems/ruby</span><span class="literal">-</span><span class="comment">1</span><span class="string">.</span><span class="comment">9</span><span class="string">.</span><span class="comment">3</span><span class="literal">-</span><span class="comment">p392/gems/charlock_holmes</span><span class="literal">-</span><span class="comment">0</span><span class="string">.</span><span class="comment">6</span><span class="string">.</span><span class="comment">9/ext/charlock_holmes/gem_make</span><span class="string">.</span><span class="comment">out</span>
</code></pre><p>이를 해결하기 위해 <code>Gitlab 메일링 그룹</code>과 <code>Stackoverflow</code> 에 문의했으나 아무런 대답이 없었고 <a href="http://twitter.com/andrwj">@andrwj</a> 가 트러블슈팅을 도와주었다.  </p><p>장작 24시간동안 메달린 오류의 원인은 너무나도 황당,간단,기본적인 녀석이였기에 엄청난 갈굼을 견더야 했지만 조공을 바치는 선에서 해결했다.</p><p><em class="label label-important"><strong>rails</strong></em>의 부제. 그렇다 지금까지 작업 히스토리를 아무리 뒤져보아도 <em class="label label-important"><strong>rails</strong></em>를 설치한 적이 없었다. 어째되었건 원인을 찾았으니 설치를 계속 진행 했다.(사실 charlock_holmes와 bundle install은 <a href="http://twitter.com/andrwj">@andrwj</a>가 진행해 주었다.)</p><p>이부분은 오류 해결을 위해 @andrwj 가 수행한 command set을 그대로 남긴다.</p><pre><code class="">// rvm 을 최신 버전으로 업데이트 
$ rvm <span class="built_in">get</span> head
<span class="comment">
// 종속 페키지 확인
</span>$ rvm requirements run<span class="comment">
// 기존 ruby 삭제
</span>$ rvm remove <span class="number">1.9</span><span class="number">.3</span><span class="comment">
// ruby 재설치 및 default 지정
</span>$ rvm use <span class="number">1.9</span><span class="number">.3</span> <span class="comment">--install --default</span><span class="comment">
// rails 설치
</span>$ gem install rails<span class="comment">
// charlock_holmes 설치
</span>$ gem install charlock_holmes <span class="comment">--version '0.6.9'</span>
<span class="comment">
// bundle install 
</span>$ bundle install <span class="comment">--deployment --without development test postgres</span>

$ bundle exec rake gitlab:setup RAILS_ENV=production
This will <span class="built_in">create</span> <span class="operator">the</span> necessary database tables <span class="operator">and</span> seed <span class="operator">the</span> database.
You will lose <span class="keyword">any</span> previous data stored <span class="operator">in</span> <span class="operator">the</span> database.
Do you want <span class="built_in">to</span> continue (yes/no)? yes
.
. (중략)
.
Administrator account created:

login.........admin@local.host
password.....<span class="number">.5</span>iveL!fe
</code></pre><p>마지막 명령을 수행하고 나오는 ouput 중 중요한 정보들이 있다. 초기 관리자 계정과 비밀번호. 나중에 다시 찾아보는걸 방지하기 위해 미리 기록해 두었다.</p>
<h2 id="toc_155">6.6 Check Application Status</h2>
<p>gitlab 을 스타트 하기 위해 필요한 녀석들이 제대로 인스톨 되었는지 확인하는 단계다. 바로 이부분에서  <em class="label label-info"><strong>Gitlab-Shell v1.2.0</strong></em> 설치 부분에서 말했던 이슈와 함께  <em class="label label-info"><strong>Gitlab-Shell</strong></em> 을 재설치 하게 되었다. </p><pre><code class=""><span class="char">$ </span>su - git

<span class="char">$ </span>cd /home/git/gitlab

// <span class="class">System</span>, <span class="class">Gitlab</span>,<span class="class">Gitlab</span>-<span class="class">Shell</span> 등의 설치 정보를 확인한다.
<span class="char">$ </span>bundle exec rake <span class="method">gitlab:</span><span class="method">env:</span>info <span class="class">RAILS_ENV</span>=production

// gitlab configure 정보를 확인한다.
<span class="char">$ </span>bundle exec rake <span class="method">gitlab:</span>check <span class="class">RAILS_ENV</span>=production
</code></pre><p>configure 확인중에 재미있는 녀석을 발견했다. 가이드에서는  <em class="label label-info"><strong>Gitlab-Shell v1.2.0</strong></em> 을 사용하라고 적혀있지만 결과는 <em class="label label-info"><strong>Gitlab-Shell v1.3.0</strong></em> 을 설치 하라고 했다. 그래서 v1.3.0 으로 재설치후 다시 확인해 보았다. </p><pre><code class="">$ bundle exec rake gitlab:env:info RAILS_ENV=production
System information
.
. (중략)
.
GitLab Shell
Version:    <span class="number">1.3</span><span class="number">.0</span>
Repositories:   /home/git/repositories/
Hooks:      /home/git/gitlab-shell/hooks/
Git:        /usr/bin/git

$ bundle exec rake gitlab:check RAILS_ENV=production
Checking Environment <span class="keyword">...</span>
.
. (중략)
.
Checking Gitlab Shell <span class="keyword">...</span>

GitLab Shell version? <span class="keyword">...</span> OK (<span class="number">1.3</span><span class="number">.0</span>)
Repo base directory exists? <span class="keyword">...</span> yes
Repo base directory is a symlink? <span class="keyword">...</span> no
Repo base owned by git:git? <span class="keyword">...</span> yes
Repo base access is drwxrws---? <span class="keyword">...</span> yes
post-receive hook up-to-date? <span class="keyword">...</span> yes
post-receive hooks <span class="keyword">in</span> repos are links: <span class="keyword">...</span> can<span class="string">'t check, you have no projects

Checking Gitlab Shell ... Finished
.
.(중략)
.
Checking GitLab ... Finished
</span></code></pre><p><em class="label label-info"><strong>Gitlab</strong></em> 과 <em class="label label-info"><strong>Gitlab-Shell</strong></em> 모두 최신 버전으로 설치가 완료 되었음이 확인 되었다. </p>
<h1 id="toc_156">7. Install init Script</h1>
<p>이부부은 gitlab을 관리하는 스크립트를 설치하는 부분임으로 다시  <em class="label label-info"><strong>root</strong></em>계정으로 변경 하였다. 특별한 이슈 없이 설치 가이드를 따라 진행했다.</p><pre><code class=""><span class="char">$ </span>curl --output /etc/init.d/gitlab <span class="method">https:</span>//raw.github.com/gitlabhq/gitlab-recipes/<span class="number">5</span>-<span class="number">1</span>-stable/init.d/gitlab

<span class="char">$ </span>chmod +x /etc/init.d/gitlab

<span class="char">$ </span>update-rc.d gitlab defaults <span class="number">21</span>

<span class="char">$ </span>service gitlab start
<span class="class">Puma</span> <span class="number">2.0</span><span class="number">.0</span>.b7 starting...
* <span class="class">Min</span> <span class="method">threads:</span> <span class="number">0</span>, max <span class="method">threads:</span> <span class="number">16</span>
* <span class="class">Environment</span>: production
* <span class="class">Listening</span> on <span class="method">tcp:</span>//gitlab.ninjacamp.<span class="method">org:</span><span class="number">9292</span>
<span class="class">Gitlab</span> service started
</code></pre>
<h1 id="toc_157">8. NginX Install</h1>
<p><em class="label label-info"><strong>9292 포트</strong></em>로 열린 Gitlab을 <em class="label label-info"><strong>80 포트</strong></em>로 서비스하기 위해 nginx 를 proxy로 사용하기로 했다. </p><pre><code class="nginx"><span class="comment">// nginx 설치</span>
$ apt<span class="attribute">-get</span> install nginx

<span class="comment">// config 다운로드 </span>
$ curl <span class="subst">--</span>output <span class="subst">/</span>etc<span class="subst">/</span>nginx<span class="subst">/</span>sites<span class="attribute">-available</span><span class="subst">/</span>gitlab https:<span class="comment">//raw.github.com/gitlabhq/gitlabhq/master/lib/support/nginx/gitlab</span>

<span class="comment">// 심볼링크 설정</span>
$ ln <span class="attribute">-s</span> <span class="subst">/</span>etc<span class="subst">/</span>nginx<span class="subst">/</span>sites<span class="attribute">-available</span><span class="subst">/</span>gitlab <span class="subst">/</span>etc<span class="subst">/</span>nginx<span class="subst">/</span>sites<span class="attribute">-enabled</span><span class="subst">/</span>gitlab

<span class="comment">// 설정 파일 수정</span>
$ vi <span class="subst">/</span>etc<span class="subst">/</span>nginx<span class="subst">/</span>sites<span class="attribute">-available</span><span class="subst">/</span>gitlab
</code></pre><p>nginx를 통해 <em class="label label-info"><strong>80 포트</strong></em>로 Request 를 받고 이를  <em class="label label-info"><strong>9292 포트</strong></em> 로 던져주는 설정만 하면 되기에 아래와 같이 수정해 주었다.</p><pre><code class=""><span class="comment"># GITLAB</span>
<span class="comment"># Maintainer: @randx</span>
<span class="comment"># App Version: 5.0</span>

<span class="title">server</span> {
  <span class="title">listen</span> <span class="number">80</span>;         <span class="comment"># e.g., listen 192.168.1.1:80;</span>
  <span class="title">server_name</span> gitlab.ninjacamp.org;     <span class="comment"># e.g., server_name source.example.com;</span>
  <span class="title">root</span> /home/git/gitlab/public;

  <span class="comment"># individual nginx logs for this gitlab vhost</span>
  <span class="title">access_log</span>  /var/log/nginx/gitlab_access.log;
  <span class="title">error_log</span>   /var/log/nginx/gitlab_error.log;

  <span class="title">location</span> / {
    <span class="comment"># serve static files from defined root folder;.</span>
    <span class="comment"># @gitlab is a named location for the upstream fallback, see below</span>
    <span class="title">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/index.html <span class="variable">$uri</span>.html <span class="variable">@gitlab</span>;
  }

  <span class="comment"># if a file, which is not found in the root folder is requested,</span>
  <span class="comment"># then the proxy pass the request to the upsteam (gitlab unicorn)</span>
  <span class="title">location</span> <span class="variable">@gitlab</span> {
    <span class="title">proxy_read_timeout</span> <span class="number">300</span>; <span class="comment"># https://github.com/gitlabhq/gitlabhq/issues/694</span>
    <span class="title">proxy_connect_timeout</span> <span class="number">300</span>; <span class="comment"># https://github.com/gitlabhq/gitlabhq/issues/694</span>
    <span class="title">proxy_redirect</span>     <span class="built_in">off</span>;

    <span class="title">proxy_set_header</span>   X-Forwarded-Proto <span class="variable">$scheme</span>;
    <span class="title">proxy_set_header</span>   Host              <span class="variable">$http_host</span>;
    <span class="title">proxy_set_header</span>   X-Real-IP         <span class="variable">$remote_addr</span>;

    <span class="title">proxy_pass</span> <span class="url">http://gitlab.ninjacamp.org:9292</span>;
  }
}

</code></pre><p>nginx 를 실행 시켜주고 서비스 되는지 확인.</p><pre><code class=""><span class="variable">$ </span>service nginx start
</code></pre><p><img src="./@img/gitlab-start.png" alt="gitlab-start"> </p>
<h1 id="toc_158">9. .bashrc PATH 설정</h1>
<p>사실 브라우저를 통해 실행 화면을 보았을때 모든게 끝이 났다고 생각했다. 하지만 크나큰 오산. </p><pre><code class=""><span class="char">$ </span>git push -u origin master
/usr/bin/<span class="method">env:</span> <span class="method">ruby:</span> 그런 파일이나 디렉터리가 없습니다
<span class="method">fatal:</span> <span class="class">Could</span> not read from remote repository.

<span class="class">Please</span> make sure you have the correct access rights
</code></pre><p>push command 를 수행하면 ruby path 를  <code>/home/git/.rvm/bin</code> 밑으로 잡지 못하고 있었다.</p><p>이를 위해 <em class="label label-info"><strong>.bashrc</strong></em> 파일 최상단에 <em class="label label-info"><strong>PATH</strong></em> 설정을 해주고 별내용 없던 <em class="label label-info"><strong>.profile</strong></em> 을 삭제 해주었다. </p><pre><code class=""><span class="variable">$ </span>su - git

<span class="variable">$ </span>vi .bashrc
/<span class="regexp">/ 최상단에 export PATH=/home</span><span class="regexp">/git/</span>.rvm/<span class="symbol">bin:</span><span class="variable">$PATH</span> 추가

<span class="variable">$ </span>rm -f .profile
</code></pre><p>이부분은 이미 백전노장 <a href="http://twitter.com/andrwj">@andrwj</a> 가 알려주었지만 깜박하고 있었기에 또한번의 갈굼을 피할길이 없었다. 이로인해 조공은 2배로 늘었다.</p><p>어째되었건 다시 push 테스트를 진행 하였고 성공적으로 모든 테스트가 완료 되었다. </p><pre><code class=""><span class="attribute">insanehong</span>:~/WorkSpace/sample(master)&gt; git push -u origin master
Counting <span class="attribute">objects</span>: <span class="number">3</span>, done.
Writing <span class="attribute">objects</span>: <span class="number">100</span>% (<span class="number">3</span>/<span class="number">3</span>), <span class="number">215</span> bytes, done.
Total <span class="number">3</span> (delta <span class="number">0</span>), reused <span class="number">0</span> (delta <span class="number">0</span>)
To git<span class="property">@gitlab</span>.ninjacamp.<span class="attribute">org</span>:Insanehong/sample.git
 * [<span class="keyword">new</span> branch]      master<span class="function"> -&gt;</span> master
Branch master set up to track remote branch master from origin.
</code></pre>
<h1 id="toc_159">마무리</h1>
<p>이로서 이번 재설치의 모든 작업을 기록으로 남기는 것이 모두 완료되었다. 처음에도 밝혔지만 별거아닌 작업이고 설치 가이드를 따라 진행했으며 백전노장의 도움을 받으면서 이글은 누군가가 이글을 따라 설치하는데 도움이 됬으면 한다거나 하는 생각으로 만든 글이 아니다. 단순히 개인의 작업을 리뷰할 생각으로 기록으로 남기고 싶었을 뿐이다.</p><p>이 작업이 완료될수 있게(평소에도 많은 도움을 받지만) 도와준  백전노장 <a href="http://twitter.com/andrwj">@andrwj</a> 에게 다시한번 감사의 말을 전하며 마친다.</p>
                        </div>
                        <hr />
                                            
                        <div class="row-fluid">
                            
                            <div class="pull-right">
                                <a href="/post/guide-to-git-for-windows" class="btn btn-info">윈도우 사용자를 위한 git client 설치 <i class="icon-white icon-chevron-right"></i></a>
                            </div>
                            

                            
                            <div class="pull-left">
                                <a href="/post/gitignore-generator-gig" class="btn btn-info"><i class="icon-white icon-chevron-left"></i> .gitignore file generator gig 소개</a>
                            </div>
                            
                        </div>
                    

                        
    <div class="row-fluid">
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'incorrectnote'; // required: replace example with your forum shortname

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>

                    </div>
                </div>
            </div>
            <div class="row">
            </div>
        </div>
    </div>
    <!--<div class="row">-->
        <!--<div class="offset3 span9">-->
            <!--<strong>tags</strong> :-->
            <!---->
            <!--<a href="/tag/git">git</a>&nbsp;-->
            <!---->
            <!--<a href="/tag/gitlab">gitlab</a>&nbsp;-->
            <!---->
            <!--<a href="/tag/gitlab5.0">gitlab5.0</a>&nbsp;-->
            <!---->
            <!--<a href="/tag/gitlab5">gitlab5</a>&nbsp;-->
            <!---->
            <!--<a href="/tag/guide">guide</a>&nbsp;-->
            <!---->
            <!--<a href="/tag/install">install</a>&nbsp;-->
            <!---->
        <!--</div>-->
    <!--</div>-->
</div><!-- /container -->


        <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="span12 ">
                    <div class="well">
                        <p class="pull-right"><a href="#">Back to top</a></p>
                            <strong>haroopress</strong> developed by <a href="http://twitter.com/rhiokim" target="_blank">@rhiokim</a>,<a href="http://twitter.com/haroopress" target="_blank">@haroopress</a> and source in <a href="https://github.com/rhiokim/haroopress" target="_blank">github</a><br/>
                            Designed and built with all the love in the world <a href="http://twitter.com/twitter" target="_blank">@twitter</a> by <a href="http://twitter.com/mdo" target="_blank">@mdo</a> and <a href="http://twitter.com/fat" target="_blank">@fat</a>.<br />
                            Code licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0" target="_blank">Apache License v2.0</a>. Documentation licensed under <a href="http://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a>.
                    </div>
                </div>
            </div>
        </div>
    </footer>

    
    <script type="text/javascript">
        var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-44036299-1']);
            _gaq.push(['_trackPageview']);

        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>



</body>
</html>
